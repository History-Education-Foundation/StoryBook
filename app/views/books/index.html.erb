<% content_for :header, "Your Books" %>
<div>
  <% if current_user.staff? || current_user.admin? %>
    <%= link_to "Add Book", new_book_path, class: "rounded px-4 py-2 bg-green-600 text-white hover:bg-green-700 font-semibold" %>
  <% end %>
</div>

<% if @books.any? %>
  <ul class="mt-6 grid gap-4">
    <% @books.each do |book| %>
      <li class="bg-white rounded shadow p-4">
        <h2 class="text-xl font-bold mb-1 flex items-center gap-2">
  <%= link_to book.title, book_chapters_path(book), class: "hover:underline text-blue-700" %>
  <% if book.status.present? %>
    <span class="inline-block px-2 py-1 rounded text-xs font-semibold
      <%= case book.status
        when 'Draft' then 'bg-yellow-100 text-yellow-800 border border-yellow-300'
        when 'Published' then 'bg-green-100 text-green-800 border border-green-300'
        when 'Archived' then 'bg-gray-200 text-gray-800 border border-gray-300'
        else 'bg-gray-100 text-gray-600 border border-gray-200' end %>">
      <%= book.status %>
    </span>
    <% if book.status == 'Published' %>
      <%= link_to "Share", public_book_path(book), target: "_blank", rel: "noopener", class: "ml-2 underline text-blue-600 text-xs" %>
      <% if book.audio.present? %>
        <span class="ml-2 text-green-700 text-sm font-semibold" title="Audio available">ðŸ”Š Audio</span>
      <% end %>
    <% end %>
  <% end %>
</h2>
        <div class="text-xs text-gray-500 mb-1">Reading Level: <%= book.reading_level.presence || 'n/a' %></div>
        <div class="mb-1 text-sm">Learning Outcome: <%= book.learning_outcome.presence || 'n/a' %></div>
        <div class="mt-2 flex gap-2">
          <% if current_user.staff? || current_user.admin? %>
  <% if book.status != 'Published' %>
    <%= link_to 'Edit', edit_book_path(book), class: 'px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600 text-sm' %>
  <% end %>
  <% if book.status == 'Draft' %>
    <%= button_to 'Publish', publish_book_path(book), method: :patch, data: { confirm: 'Are you sure? This will publish the book.' }, class: 'px-3 py-1 rounded bg-blue-700 text-white hover:bg-blue-800 text-sm' %>
  <% elsif book.status == 'Published' %>
    <%= button_to 'Archive', archive_book_path(book), method: :patch, data: { confirm: 'Are you sure? This will move the book to archive.' }, class: 'px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-800 text-sm' %>
  <% elsif book.status == 'Archived' %>
    <%= button_to 'Publish', publish_book_path(book), method: :patch, data: { confirm: 'Are you sure? This will re-publish the book.' }, class: 'px-3 py-1 rounded bg-blue-700 text-white hover:bg-blue-800 text-sm' %>
  <% end %>
  <%= link_to 'Delete', book_path(book), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this book?' }, class: 'px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700 text-sm' %>
<% elsif current_user.student? && book.status == 'Published' %>
            <% if current_user.saved_books_library.exists?(id: book.id) %>
              <button class="px-3 py-1 rounded bg-indigo-100 text-indigo-700 text-sm font-semibold cursor-default" disabled>Saved</button>
              <%= button_to 'Remove from My Library', unsave_book_path(book), method: :delete, form: { data: { turbo: "false" } }, class: 'px-3 py-1 rounded bg-red-50 text-red-700 text-sm font-semibold', data: { turbo_confirm: 'Are you sure?' } %>
            <% else %>
              <%= button_to 'Add to My Library', save_book_path(book), method: :post, form: { data: { turbo: "false" } }, class: 'px-3 py-1 rounded bg-indigo-600 text-white hover:bg-indigo-700 text-sm' %>
            <% end %>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
<% else %>
  <div class="mt-6 text-gray-400 italic">You have no books yet.</div>
<% end %>
