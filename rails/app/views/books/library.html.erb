<% content_for :header, "My Library" %>

<div class="flex gap-2 mb-6">
  <%= link_to "All Books", library_books_path, class: "px-4 py-2 rounded font-semibold #{params[:filter] != 'liked' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}" %>
  <%= link_to "Liked Books", library_books_path(filter: :liked), class: "px-4 py-2 rounded font-semibold #{params[:filter] == 'liked' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}" %>
</div>

<% liked_ids = current_user.saved_books_library.pluck(:id) %>

<% if @books.any? %>
  <ul class="mt-6 grid gap-4">
    <% @books.each do |book| %>
      <li class="bg-white rounded shadow p-4">
        <h2 class="text-xl font-bold mb-1 flex items-center gap-2">
          <%= link_to book.title, read_books_path(book), class: "hover:underline text-blue-700" %>
          <% if book.status.present? %>
            <span class="inline-block px-2 py-1 rounded text-xs font-semibold
              <%= case book.status
                when 'Draft' then 'bg-yellow-100 text-yellow-800 border border-yellow-300'
                when 'Published' then 'bg-green-100 text-green-800 border border-green-300'
                when 'Archived' then 'bg-gray-200 text-gray-800 border border-gray-300'
                else 'bg-gray-100 text-gray-600 border border-gray-200' end %>">
              <%= book.status %>
            </span>
          <% end %>
        </h2>
        <div class="text-xs text-gray-500 mb-1">Reading Level: <%= book.reading_level.presence || 'n/a' %></div>
        <div class="mb-1 text-sm">Learning Outcome: <%= book.learning_outcome.presence || 'n/a' %></div>
        <div class="mt-2 flex gap-2">
          <% if liked_ids.include?(book.id) %>
            <%= button_to 'Unlike', unsave_book_path(book), method: :delete, class: 'px-3 py-1 rounded bg-red-50 text-red-700 text-sm font-semibold' %>
          <% else %>
            <%= button_to 'Like', save_book_path(book), method: :post, form: { data: { turbo: "false" } }, class: 'px-3 py-1 rounded bg-blue-50 text-blue-700 text-sm font-semibold' %>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
<% else %>
  <div class="mt-6 text-gray-400 italic">
    <% if params[:filter] == 'liked' %>
      You haven't liked any books yet.
    <% else %>
      No published books found.
    <% end %>
  </div>
<% end %>
