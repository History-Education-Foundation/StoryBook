<% content_for :header, "My Library" %>

<!-- Navigation buttons - Desktop and Mobile -->
<div class="flex gap-3 mb-6">
  <%= link_to library_books_path, class: "btn gap-2 flex-1 md:flex-initial #{params[:filter] != 'liked' ? '' : 'btn-ghost'}", style: "#{params[:filter] != 'liked' ? 'background-color: #e0e7ff; color: #4338ca; border-color: #c7d2fe;' : 'background-color: #f3f4f6; color: #6b7280; border-color: #e5e7eb;'}" do %>
    <i class="fas fa-book"></i>
    <span class="hidden sm:inline">All Books</span>
    <span class="sm:hidden">All</span>
  <% end %>
  <%= link_to library_books_path(filter: :liked), class: "btn gap-2 flex-1 md:flex-initial #{params[:filter] == 'liked' ? '' : 'btn-ghost'}", style: "#{params[:filter] == 'liked' ? 'background-color: #fce7f3; color: #be185d; border-color: #fbcfe8;' : 'background-color: #f3f4f6; color: #6b7280; border-color: #e5e7eb;'}" do %>
    <i class="fas fa-heart"></i>
    <span class="hidden sm:inline">Liked Books</span>
    <span class="sm:hidden">Liked</span>
  <% end %>
</div>

<% liked_ids = current_user.saved_books_library.pluck(:id) %>

<% if @books.any? %>
  <!-- Books Grid -->
  <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-1">
    <% @books.each do |book| %>
      <div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-200">
        <div class="card-body">
          <!-- Book Title & Status -->
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <h2 class="card-title text-2xl flex-grow">
              <%= link_to book.title, read_books_path(book), class: "link link-primary hover:link-hover" %>
            </h2>
            
            <% if book.status.present? %>
              <div class="badge badge-lg" style="<%= case book.status
                when 'Draft' then 'background-color: #fef3c7; color: #b45309; border-color: #fde68a;'
                when 'Published' then 'background-color: #d1fae5; color: #047857; border-color: #a7f3d0;'
                when 'Archived' then 'background-color: #f1f5f9; color: #475569; border-color: #e2e8f0;'
                else 'background-color: #f3f4f6; color: #4b5563; border-color: #e5e7eb;' end %>">
                <%= book.status %>
              </div>
            <% end %>
            
            <% if liked_ids.include?(book.id) %>
              <div class="badge gap-1" style="background-color: #fce7f3; color: #be185d; border-color: #fbcfe8;">
                <i class="fas fa-heart"></i>
                Liked
              </div>
            <% end %>
          </div>

          <!-- Book Details -->
          <div class="space-y-2 mb-4">
            <div class="flex items-center gap-2 text-sm">
              <i class="fas fa-book-reader text-base-content/60"></i>
              <span class="text-base-content/70">Reading Level:</span>
              <span class="font-medium"><%= book.reading_level.presence || 'Not specified' %></span>
            </div>
            <!-- Learning Outcome: stacked on mobile, inline on desktop -->
            <div class="text-sm block sm:flex sm:items-start sm:gap-2">
              <div class="flex items-center gap-2 mb-1 sm:mb-0">
                <i class="fas fa-bullseye text-base-content/60"></i>
                <span class="text-base-content/70">Learning Outcome:</span>
              </div>
              <div class="font-medium ml-6 sm:ml-0 sm:flex-1"><%= book.learning_outcome.presence || 'Not specified' %></div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="card-actions justify-start flex-wrap">
            <% if liked_ids.include?(book.id) %>
              <%= button_to unsave_book_path(book), method: :delete, class: 'btn btn-sm gap-1', style: "background-color: #fff1f2; color: #be123c; border-color: #fecdd3;" do %>
                <i class="fas fa-heart-broken"></i>
                Unlike
              <% end %>
            <% else %>
              <%= button_to save_book_path(book), method: :post, form: { data: { turbo: "false" } }, class: 'btn btn-sm gap-1', style: "background-color: #fce7f3; color: #be185d; border-color: #fbcfe8;" do %>
                <i class="fas fa-heart"></i>
                Like
              <% end %>
            <% end %>
            
            <%= link_to read_books_path(book), class: 'btn btn-sm gap-1', style: "background-color: #dbeafe; color: #1e40af; border-color: #bfdbfe;" do %>
              <i class="fas fa-book-open"></i>
              Read Book
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- Empty State -->
  <div class="card bg-base-100 shadow-lg">
    <div class="card-body items-center text-center">
      <i class="fas <%= params[:filter] == 'liked' ? 'fa-heart-crack' : 'fa-book-open' %> text-6xl text-indigo-200 mb-4"></i>
      <h3 class="card-title text-slate-600">
        <% if params[:filter] == 'liked' %>
          No liked books yet
        <% else %>
          No published books found
        <% end %>
      </h3>
      <p class="text-slate-500">
        <% if params[:filter] == 'liked' %>
          Start liking books to build your collection!
        <% else %>
          Check back soon for new books.
        <% end %>
      </p>
    </div>
  </div>
<% end %>
