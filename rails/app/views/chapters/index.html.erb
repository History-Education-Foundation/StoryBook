<% content_for :header, "Chapters in '#{@book.title}'" %>
<div class="flex gap-4">
  <%= link_to "← Back to Books", books_path, class: "rounded px-4 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold" %>
  <%= link_to "Add Chapter", new_book_chapter_path(@book), class: "rounded px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-semibold" %>
  <% if ["Draft", "Archived"].include?(@book.status) %>
    <%= button_to "Generate All Pictures", generate_all_pictures_book_path(@book), method: :post, class: "rounded px-4 py-2 bg-green-600 text-white font-semibold hover:bg-green-700", data: { turbo_confirm: "This will generate or replace all images for every page in this book. Continue?" } %>
    <%= button_to "Retry Failed Images", retry_failed_pictures_book_path(@book), method: :post, class: "rounded px-4 py-2 bg-orange-500 text-white font-semibold hover:bg-orange-600", data: { turbo_confirm: "This will retry image generation only for pages missing images. Continue?" } %>
  <% end %>
</div>

<% if @chapters.any? %>
  <ul class="mt-6 grid gap-4">
    <% @chapters.each do |chapter| %>
      <li class="bg-white rounded shadow p-4">
        <h2 class="text-lg font-bold mb-1">
          <%= link_to chapter.title, book_chapter_pages_path(@book, chapter), class: "hover:underline text-purple-700" %>
        </h2>
        <div class="mb-1 text-sm">Description: <%= chapter.description.presence || 'n/a' %></div>
        <% if @book.status != 'Published' %>
          <div class="mt-2 flex gap-2">
            <%= link_to 'Edit', edit_book_chapter_path(@book, chapter), class: 'px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600 text-sm' %>
            <%= link_to 'Delete', book_chapter_path(@book, chapter), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this chapter?' }, class: 'px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700 text-sm' %>
          </div>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <div class="mt-6 text-gray-400 italic">No chapters yet for this book.</div>
<% end %>
