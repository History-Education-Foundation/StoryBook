<% content_for :header, "Chapters in '#{@book.title}'" %>

<!-- Navigation and Action Buttons -->
<div class="flex flex-wrap gap-3 mb-6">
  <%= link_to books_path, class: "btn gap-2", style: "background-color: #f3f4f6; color: #374151; border-color: #e5e7eb;" do %>
    <i class="fas fa-arrow-left"></i>
    Back to Books
  <% end %>
  
  <%= link_to new_book_chapter_path(@book), class: "btn gap-2", style: "background-color: #e0e7ff; color: #4338ca; border-color: #c7d2fe;" do %>
    <i class="fas fa-plus"></i>
    Add Chapter
  <% end %>
  
  <% if ["Draft", "Archived"].include?(@book.status) %>
    <%= button_to generate_all_pictures_book_path(@book), method: :post, class: "btn gap-2", style: "background-color: #d1fae5; color: #047857; border-color: #a7f3d0;", data: { turbo_confirm: "This will generate or replace all images for every page in this book. Continue?" } do %>
      <i class="fas fa-images"></i>
      Generate All Pictures
    <% end %>
    
    <%= button_to retry_failed_pictures_book_path(@book), method: :post, class: "btn gap-2", style: "background-color: #fed7aa; color: #c2410c; border-color: #fdba74;", data: { turbo_confirm: "This will retry image generation only for pages missing images. Continue?" } do %>
      <i class="fas fa-redo"></i>
      Retry Failed Images
    <% end %>
  <% end %>
</div>

<% if @chapters.any? %>
  <!-- Chapters Grid -->
  <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-1">
    <% @chapters.each_with_index do |chapter, idx| %>
      <div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-200">
        <div class="card-body">
          <!-- Chapter Title -->
          <div class="flex items-center gap-3 mb-3">
            <div class="badge badge-lg" style="background-color: #ddd6fe; color: #5b21b6; border-color: #c4b5fd;">
              Chapter <%= idx + 1 %>
            </div>
            <h2 class="card-title text-xl flex-grow">
              <%= link_to chapter.title, book_chapter_pages_path(@book, chapter), class: "link link-primary hover:link-hover" %>
            </h2>
          </div>

          <!-- Chapter Description -->
          <div class="mb-4">
            <div class="flex items-start gap-2 text-sm">
              <i class="fas fa-align-left text-base-content/60 mt-1"></i>
              <span class="text-base-content/70">Description:</span>
              <span class="font-medium flex-1"><%= chapter.description.presence || 'Not specified' %></span>
            </div>
          </div>

          <!-- Action Buttons -->
          <% if @book.status != 'Published' %>
            <div class="card-actions justify-start flex-wrap">
              <%= link_to edit_book_chapter_path(@book, chapter), class: "btn btn-sm gap-1", style: "background-color: #fef3c7; color: #b45309; border-color: #fde68a;" do %>
                <i class="fas fa-edit"></i>
                Edit
              <% end %>
              
              <%= link_to book_chapter_path(@book, chapter), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this chapter?' }, class: "btn btn-sm gap-1", style: "background-color: #ffe4e6; color: #be123c; border-color: #fecdd3;" do %>
                <i class="fas fa-trash"></i>
                Delete
              <% end %>
              
              <%= link_to book_chapter_pages_path(@book, chapter), class: "btn btn-sm gap-1", style: "background-color: #dbeafe; color: #1e40af; border-color: #bfdbfe;" do %>
                <i class="fas fa-book-open"></i>
                View Pages
              <% end %>
            </div>
          <% else %>
            <div class="card-actions justify-start">
              <%= link_to book_chapter_pages_path(@book, chapter), class: "btn btn-sm gap-1", style: "background-color: #dbeafe; color: #1e40af; border-color: #bfdbfe;" do %>
                <i class="fas fa-book-open"></i>
                View Pages
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- Empty State -->
  <div class="card bg-base-100 shadow-lg">
    <div class="card-body items-center text-center">
      <i class="fas fa-book text-6xl text-indigo-200 mb-4"></i>
      <h3 class="card-title text-slate-600">No chapters yet</h3>
      <p class="text-slate-500">Start building your book by adding the first chapter!</p>
      <div class="card-actions">
        <%= link_to new_book_chapter_path(@book), class: "btn gap-2 mt-4", style: "background-color: #e0e7ff; color: #4338ca; border-color: #c7d2fe;" do %>
          <i class="fas fa-plus"></i>
          Add Your First Chapter
        <% end %>
      </div>
    </div>
  </div>
<% end %>
